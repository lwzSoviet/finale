#!/usr/bin/python2
# -*- coding: utf-8 -*-
"""
    @Description: Simple Unit Test
    ~~~~~~
    @Author  : pake
    @Time    : 2021/7/2 10:10
"""
import pytest
from engine import func_equals_classcall, add_node_id, get_node, get_name_value, get_arg_value, \
    get_all_assigns, get_all_functiondef, get_all_classdef, get_end_id, get_call_details, is_tracked, is_controllable, \
    ins_is_class, get_class_name, Point, gen_chains, Taint


def test_func_equals_classcall():
    # call_name, classcall_name
    p=[('os.system','ClassCall:System.system'),
        ('a.system','ClassCall:A.system'),
        ('pickle.loads','ClassCall:self.loads'),
        ('self.inital_db','ClassCall:Mysql.inital_db'),]
    for i in p:
        assert func_equals_classcall(i[0],i[1])==i[1]

def test_add_node_id():
    a={'name': 'Module', 'children': [{'name': 'Import', 'children': [{'name': 'alias', 'children': [{'name': 'str(str=os)'}, {'name': 'NoneType'}]}]}, {'name': 'ImportFrom', 'children': [{'name': 'str(str=importlib)'}, {'name': 'alias', 'children': [{'name': 'str(str=import_module)'}, {'name': 'NoneType'}]}, {'name': 'int(int=0)'}]}, {'name': 'ImportFrom', 'children': [{'name': 'str'}, {'name': 'alias', 'children': [{'name': 'str(str=ImproperlyConfigured)'}, {'name': 'NoneType'}]}, {'name': 'int(int=0)'}]}, {'name': 'ImportFrom', 'children': [{'name': 'str'}, {'name': 'alias', 'children': [{'name': 'str(str=upath)'}, {'name': 'NoneType'}]}, {'name': 'int(int=0)'}]}, {'name': 'ImportFrom', 'children': [{'name': 'str'}, {'name': 'alias', 'children': [{'name': 'str(str=module_has_submodule)'}, {'name': 'NoneType'}]}, {'name': 'int(int=0)'}]}, {'name': 'Assign', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=MODELS_MODULE_NAME)'}, {'name': 'Store'}]}, {'name': 'Str', 'children': [{'name': 'str(str=models)'}]}]}, {'name': 'ClassDef', 'children': [{'name': 'str(str=AppConfig)'}, {'name': 'Name', 'children': [{'name': 'str(str=object)'}, {'name': 'Load'}]}, {'name': 'list[]'}, {'name': 'Expr', 'children': [{'name': 'Str', 'children': [{'name': 'str'}]}]}, {'name': 'FunctionDef', 'children': [{'name': 'str(str=__init__)'}, {'name': 'arguments', 'children': [{'name': 'arg', 'children': [{'name': 'str(str=self)'}, {'name': 'NoneType'}]}, {'name': 'arg', 'children': [{'name': 'str(str=app_name)'}, {'name': 'NoneType'}]}, {'name': 'arg', 'children': [{'name': 'str(str=app_module)'}, {'name': 'NoneType'}]}, {'name': 'NoneType'}, {'name': 'list[]'}, {'name': 'list[]'}, {'name': 'NoneType'}, {'name': 'list[]'}]}, {'name': 'Assign', 'children': [{'name': 'Attribute', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=self)'}, {'name': 'Load'}]}, {'name': 'str(str=name)'}, {'name': 'Store'}]}, {'name': 'Name', 'children': [{'name': 'str(str=app_name)'}, {'name': 'Load'}]}]}, {'name': 'Assign', 'children': [{'name': 'Attribute', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=self)'}, {'name': 'Load'}]}, {'name': 'str(str=module)'}, {'name': 'Store'}]}, {'name': 'Name', 'children': [{'name': 'str(str=app_module)'}, {'name': 'Load'}]}]}, {'name': 'Assign', 'children': [{'name': 'Attribute', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=self)'}, {'name': 'Load'}]}, {'name': 'str(str=apps)'}, {'name': 'Store'}]}, {'name': 'NameConstant', 'children': [{'name': 'NoneType'}]}]}, {'name': 'If', 'children': [{'name': 'UnaryOp', 'children': [{'name': 'Not'}, {'name': 'Call', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=hasattr)'}, {'name': 'Load'}]}, {'name': 'Name', 'children': [{'name': 'str(str=self)'}, {'name': 'Load'}]}, {'name': 'Str', 'children': [{'name': 'str(str=label)'}]}, {'name': 'list[]'}]}]}, {'name': 'Assign', 'children': [{'name': 'Attribute', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=self)'}, {'name': 'Load'}]}, {'name': 'str(str=label)'}, {'name': 'Store'}]}, {'name': 'Subscript', 'children': [{'name': 'Call', 'children': [{'name': 'Attribute', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=app_name)'}, {'name': 'Load'}]}, {'name': 'str(str=rpartition)'}, {'name': 'Load'}]}, {'name': 'Str', 'children': [{'name': 'str'}]}, {'name': 'list[]'}]}, {'name': 'Index', 'children': [{'name': 'Num', 'children': [{'name': 'int(int=2)'}]}]}, {'name': 'Load'}]}]}, {'name': 'list[]'}]}, {'name': 'If', 'children': [{'name': 'UnaryOp', 'children': [{'name': 'Not'}, {'name': 'Call', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=hasattr)'}, {'name': 'Load'}]}, {'name': 'Name', 'children': [{'name': 'str(str=self)'}, {'name': 'Load'}]}, {'name': 'Str', 'children': [{'name': 'str(str=verbose_name)'}]}, {'name': 'list[]'}]}]}, {'name': 'Assign', 'children': [{'name': 'Attribute', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=self)'}, {'name': 'Load'}]}, {'name': 'str(str=verbose_name)'}, {'name': 'Store'}]}, {'name': 'Call', 'children': [{'name': 'Attribute', 'children': [{'name': 'Attribute', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=self)'}, {'name': 'Load'}]}, {'name': 'str(str=label)'}, {'name': 'Load'}]}, {'name': 'str(str=title)'}, {'name': 'Load'}]}, {'name': 'list[]'}, {'name': 'list[]'}]}]}, {'name': 'list[]'}]}, {'name': 'If', 'children': [{'name': 'UnaryOp', 'children': [{'name': 'Not'}, {'name': 'Call', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=hasattr)'}, {'name': 'Load'}]}, {'name': 'Name', 'children': [{'name': 'str(str=self)'}, {'name': 'Load'}]}, {'name': 'Str', 'children': [{'name': 'str(str=path)'}]}, {'name': 'list[]'}]}]}, {'name': 'Assign', 'children': [{'name': 'Attribute', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=self)'}, {'name': 'Load'}]}, {'name': 'str(str=path)'}, {'name': 'Store'}]}, {'name': 'Call', 'children': [{'name': 'Attribute', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=self)'}, {'name': 'Load'}]}, {'name': 'str(str=_path_from_module)'}, {'name': 'Load'}]}, {'name': 'Name', 'children': [{'name': 'str(str=app_module)'}, {'name': 'Load'}]}, {'name': 'list[]'}]}]}, {'name': 'list[]'}]}, {'name': 'Assign', 'children': [{'name': 'Attribute', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=self)'}, {'name': 'Load'}]}, {'name': 'str(str=models_module)'}, {'name': 'Store'}]}, {'name': 'NameConstant', 'children': [{'name': 'NoneType'}]}]}, {'name': 'Assign', 'children': [{'name': 'Attribute', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=self)'}, {'name': 'Load'}]}, {'name': 'str(str=models)'}, {'name': 'Store'}]}, {'name': 'NameConstant', 'children': [{'name': 'NoneType'}]}]}, {'name': 'list[]'}, {'name': 'NoneType'}]}, {'name': 'FunctionDef', 'children': [{'name': 'str(str=__repr__)'}, {'name': 'arguments', 'children': [{'name': 'arg', 'children': [{'name': 'str(str=self)'}, {'name': 'NoneType'}]}, {'name': 'NoneType'}, {'name': 'list[]'}, {'name': 'list[]'}, {'name': 'NoneType'}, {'name': 'list[]'}]}, {'name': 'Return', 'children': [{'name': 'BinOp', 'children': [{'name': 'Str', 'children': [{'name': 'str'}]}, {'name': 'Mod'}, {'name': 'Tuple', 'children': [{'name': 'Attribute', 'children': [{'name': 'Attribute', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=self)'}, {'name': 'Load'}]}, {'name': 'str(str=__class__)'}, {'name': 'Load'}]}, {'name': 'str(str=__name__)'}, {'name': 'Load'}]}, {'name': 'Attribute', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=self)'}, {'name': 'Load'}]}, {'name': 'str(str=label)'}, {'name': 'Load'}]}, {'name': 'Load'}]}]}]}, {'name': 'list[]'}, {'name': 'NoneType'}]}, {'name': 'FunctionDef', 'children': [{'name': 'str(str=_path_from_module)'}, {'name': 'arguments', 'children': [{'name': 'arg', 'children': [{'name': 'str(str=self)'}, {'name': 'NoneType'}]}, {'name': 'arg', 'children': [{'name': 'str(str=module)'}, {'name': 'NoneType'}]}, {'name': 'NoneType'}, {'name': 'list[]'}, {'name': 'list[]'}, {'name': 'NoneType'}, {'name': 'list[]'}]}, {'name': 'Expr', 'children': [{'name': 'Str', 'children': [{'name': 'str'}]}]}, {'name': 'Assign', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=paths)'}, {'name': 'Store'}]}, {'name': 'Call', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=list)'}, {'name': 'Load'}]}, {'name': 'Call', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=getattr)'}, {'name': 'Load'}]}, {'name': 'Name', 'children': [{'name': 'str(str=module)'}, {'name': 'Load'}]}, {'name': 'Str', 'children': [{'name': 'str(str=__path__)'}]}, {'name': 'List', 'children': [{'name': 'list[]'}, {'name': 'Load'}]}, {'name': 'list[]'}]}, {'name': 'list[]'}]}]}, {'name': 'If', 'children': [{'name': 'Compare', 'children': [{'name': 'Call', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=len)'}, {'name': 'Load'}]}, {'name': 'Name', 'children': [{'name': 'str(str=paths)'}, {'name': 'Load'}]}, {'name': 'list[]'}]}, {'name': 'NotEq'}, {'name': 'Num', 'children': [{'name': 'int(int=1)'}]}]}, {'name': 'Assign', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=filename)'}, {'name': 'Store'}]}, {'name': 'Call', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=getattr)'}, {'name': 'Load'}]}, {'name': 'Name', 'children': [{'name': 'str(str=module)'}, {'name': 'Load'}]}, {'name': 'Str', 'children': [{'name': 'str(str=__file__)'}]}, {'name': 'NameConstant', 'children': [{'name': 'NoneType'}]}, {'name': 'list[]'}]}]}, {'name': 'If', 'children': [{'name': 'Compare', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=filename)'}, {'name': 'Load'}]}, {'name': 'IsNot'}, {'name': 'NameConstant', 'children': [{'name': 'NoneType'}]}]}, {'name': 'Assign', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=paths)'}, {'name': 'Store'}]}, {'name': 'List', 'children': [{'name': 'Call', 'children': [{'name': 'Attribute', 'children': [{'name': 'Attribute', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=os)'}, {'name': 'Load'}]}, {'name': 'str(str=path)'}, {'name': 'Load'}]}, {'name': 'str(str=dirname)'}, {'name': 'Load'}]}, {'name': 'Name', 'children': [{'name': 'str(str=filename)'}, {'name': 'Load'}]}, {'name': 'list[]'}]}, {'name': 'Load'}]}]}, {'name': 'Assign', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=paths)'}, {'name': 'Store'}]}, {'name': 'Call', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=list)'}, {'name': 'Load'}]}, {'name': 'Call', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=set)'}, {'name': 'Load'}]}, {'name': 'Name', 'children': [{'name': 'str(str=paths)'}, {'name': 'Load'}]}, {'name': 'list[]'}]}, {'name': 'list[]'}]}]}]}, {'name': 'list[]'}]}, {'name': 'If', 'children': [{'name': 'Compare', 'children': [{'name': 'Call', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=len)'}, {'name': 'Load'}]}, {'name': 'Name', 'children': [{'name': 'str(str=paths)'}, {'name': 'Load'}]}, {'name': 'list[]'}]}, {'name': 'Gt'}, {'name': 'Num', 'children': [{'name': 'int(int=1)'}]}]}, {'name': 'Raise', 'children': [{'name': 'Call', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=ImproperlyConfigured)'}, {'name': 'Load'}]}, {'name': 'BinOp', 'children': [{'name': 'Str', 'children': [{'name': 'str'}]}, {'name': 'Mod'}, {'name': 'Tuple', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=module)'}, {'name': 'Load'}]}, {'name': 'Name', 'children': [{'name': 'str(str=paths)'}, {'name': 'Load'}]}, {'name': 'Load'}]}]}, {'name': 'list[]'}]}, {'name': 'NoneType'}]}, {'name': 'If', 'children': [{'name': 'UnaryOp', 'children': [{'name': 'Not'}, {'name': 'Name', 'children': [{'name': 'str(str=paths)'}, {'name': 'Load'}]}]}, {'name': 'Raise', 'children': [{'name': 'Call', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=ImproperlyConfigured)'}, {'name': 'Load'}]}, {'name': 'BinOp', 'children': [{'name': 'Str', 'children': [{'name': 'str'}]}, {'name': 'Mod'}, {'name': 'Tuple', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=module)'}, {'name': 'Load'}]}, {'name': 'Load'}]}]}, {'name': 'list[]'}]}, {'name': 'NoneType'}]}, {'name': 'list[]'}]}]}, {'name': 'Return', 'children': [{'name': 'Call', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=upath)'}, {'name': 'Load'}]}, {'name': 'Subscript', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=paths)'}, {'name': 'Load'}]}, {'name': 'Index', 'children': [{'name': 'Num', 'children': [{'name': 'int(int=0)'}]}]}, {'name': 'Load'}]}, {'name': 'list[]'}]}]}, {'name': 'list[]'}, {'name': 'NoneType'}]}, {'name': 'FunctionDef', 'children': [{'name': 'str(str=create)'}, {'name': 'arguments', 'children': [{'name': 'arg', 'children': [{'name': 'str(str=cls)'}, {'name': 'NoneType'}]}, {'name': 'arg', 'children': [{'name': 'str(str=entry)'}, {'name': 'NoneType'}]}, {'name': 'NoneType'}, {'name': 'list[]'}, {'name': 'list[]'}, {'name': 'NoneType'}, {'name': 'list[]'}]}, {'name': 'Expr', 'children': [{'name': 'Str', 'children': [{'name': 'str'}]}]}, {'name': 'Try', 'children': [{'name': 'Assign', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=module)'}, {'name': 'Store'}]}, {'name': 'Call', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=import_module)'}, {'name': 'Load'}]}, {'name': 'Name', 'children': [{'name': 'str(str=entry)'}, {'name': 'Load'}]}, {'name': 'list[]'}]}]}, {'name': 'ExceptHandler', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=ImportError)'}, {'name': 'Load'}]}, {'name': 'NoneType'}, {'name': 'Assign', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=module)'}, {'name': 'Store'}]}, {'name': 'NameConstant', 'children': [{'name': 'NoneType'}]}]}, {'name': 'Assign', 'children': [{'name': 'Tuple', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=mod_path)'}, {'name': 'Store'}]}, {'name': 'Name', 'children': [{'name': 'str(str=_)'}, {'name': 'Store'}]}, {'name': 'Name', 'children': [{'name': 'str(str=cls_name)'}, {'name': 'Store'}]}, {'name': 'Store'}]}, {'name': 'Call', 'children': [{'name': 'Attribute', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=entry)'}, {'name': 'Load'}]}, {'name': 'str(str=rpartition)'}, {'name': 'Load'}]}, {'name': 'Str', 'children': [{'name': 'str'}]}, {'name': 'list[]'}]}]}, {'name': 'If', 'children': [{'name': 'UnaryOp', 'children': [{'name': 'Not'}, {'name': 'Name', 'children': [{'name': 'str(str=mod_path)'}, {'name': 'Load'}]}]}, {'name': 'Raise', 'children': [{'name': 'NoneType'}, {'name': 'NoneType'}]}, {'name': 'list[]'}]}]}, {'name': 'Try', 'children': [{'name': 'Assign', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=entry)'}, {'name': 'Store'}]}, {'name': 'Attribute', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=module)'}, {'name': 'Load'}]}, {'name': 'str(str=default_app_config)'}, {'name': 'Load'}]}]}, {'name': 'ExceptHandler', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=AttributeError)'}, {'name': 'Load'}]}, {'name': 'NoneType'}, {'name': 'Return', 'children': [{'name': 'Call', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=cls)'}, {'name': 'Load'}]}, {'name': 'Name', 'children': [{'name': 'str(str=entry)'}, {'name': 'Load'}]}, {'name': 'Name', 'children': [{'name': 'str(str=module)'}, {'name': 'Load'}]}, {'name': 'list[]'}]}]}]}, {'name': 'Assign', 'children': [{'name': 'Tuple', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=mod_path)'}, {'name': 'Store'}]}, {'name': 'Name', 'children': [{'name': 'str(str=_)'}, {'name': 'Store'}]}, {'name': 'Name', 'children': [{'name': 'str(str=cls_name)'}, {'name': 'Store'}]}, {'name': 'Store'}]}, {'name': 'Call', 'children': [{'name': 'Attribute', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=entry)'}, {'name': 'Load'}]}, {'name': 'str(str=rpartition)'}, {'name': 'Load'}]}, {'name': 'Str', 'children': [{'name': 'str'}]}, {'name': 'list[]'}]}]}, {'name': 'list[]'}]}, {'name': 'list[]'}]}, {'name': 'Assign', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=mod)'}, {'name': 'Store'}]}, {'name': 'Call', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=import_module)'}, {'name': 'Load'}]}, {'name': 'Name', 'children': [{'name': 'str(str=mod_path)'}, {'name': 'Load'}]}, {'name': 'list[]'}]}]}, {'name': 'Try', 'children': [{'name': 'Assign', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=cls)'}, {'name': 'Store'}]}, {'name': 'Call', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=getattr)'}, {'name': 'Load'}]}, {'name': 'Name', 'children': [{'name': 'str(str=mod)'}, {'name': 'Load'}]}, {'name': 'Name', 'children': [{'name': 'str(str=cls_name)'}, {'name': 'Load'}]}, {'name': 'list[]'}]}]}, {'name': 'ExceptHandler', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=AttributeError)'}, {'name': 'Load'}]}, {'name': 'NoneType'}, {'name': 'If', 'children': [{'name': 'Compare', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=module)'}, {'name': 'Load'}]}, {'name': 'Is'}, {'name': 'NameConstant', 'children': [{'name': 'NoneType'}]}]}, {'name': 'Expr', 'children': [{'name': 'Call', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=import_module)'}, {'name': 'Load'}]}, {'name': 'Name', 'children': [{'name': 'str(str=entry)'}, {'name': 'Load'}]}, {'name': 'list[]'}]}]}, {'name': 'Raise', 'children': [{'name': 'NoneType'}, {'name': 'NoneType'}]}]}]}, {'name': 'list[]'}, {'name': 'list[]'}]}, {'name': 'If', 'children': [{'name': 'UnaryOp', 'children': [{'name': 'Not'}, {'name': 'Call', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=issubclass)'}, {'name': 'Load'}]}, {'name': 'Name', 'children': [{'name': 'str(str=cls)'}, {'name': 'Load'}]}, {'name': 'Name', 'children': [{'name': 'str(str=AppConfig)'}, {'name': 'Load'}]}, {'name': 'list[]'}]}]}, {'name': 'Raise', 'children': [{'name': 'Call', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=ImproperlyConfigured)'}, {'name': 'Load'}]}, {'name': 'BinOp', 'children': [{'name': 'Str', 'children': [{'name': 'str'}]}, {'name': 'Mod'}, {'name': 'Name', 'children': [{'name': 'str(str=entry)'}, {'name': 'Load'}]}]}, {'name': 'list[]'}]}, {'name': 'NoneType'}]}, {'name': 'list[]'}]}, {'name': 'Try', 'children': [{'name': 'Assign', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=app_name)'}, {'name': 'Store'}]}, {'name': 'Attribute', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=cls)'}, {'name': 'Load'}]}, {'name': 'str(str=name)'}, {'name': 'Load'}]}]}, {'name': 'ExceptHandler', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=AttributeError)'}, {'name': 'Load'}]}, {'name': 'NoneType'}, {'name': 'Raise', 'children': [{'name': 'Call', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=ImproperlyConfigured)'}, {'name': 'Load'}]}, {'name': 'BinOp', 'children': [{'name': 'Str', 'children': [{'name': 'str'}]}, {'name': 'Mod'}, {'name': 'Name', 'children': [{'name': 'str(str=entry)'}, {'name': 'Load'}]}]}, {'name': 'list[]'}]}, {'name': 'NoneType'}]}]}, {'name': 'list[]'}, {'name': 'list[]'}]}, {'name': 'Try', 'children': [{'name': 'Assign', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=app_module)'}, {'name': 'Store'}]}, {'name': 'Call', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=import_module)'}, {'name': 'Load'}]}, {'name': 'Name', 'children': [{'name': 'str(str=app_name)'}, {'name': 'Load'}]}, {'name': 'list[]'}]}]}, {'name': 'ExceptHandler', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=ImportError)'}, {'name': 'Load'}]}, {'name': 'NoneType'}, {'name': 'Raise', 'children': [{'name': 'Call', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=ImproperlyConfigured)'}, {'name': 'Load'}]}, {'name': 'BinOp', 'children': [{'name': 'Str', 'children': [{'name': 'str'}]}, {'name': 'Mod'}, {'name': 'Tuple', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=app_name)'}, {'name': 'Load'}]}, {'name': 'Name', 'children': [{'name': 'str(str=mod_path)'}, {'name': 'Load'}]}, {'name': 'Name', 'children': [{'name': 'str(str=cls_name)'}, {'name': 'Load'}]}, {'name': 'Load'}]}]}, {'name': 'list[]'}]}, {'name': 'NoneType'}]}]}, {'name': 'list[]'}, {'name': 'list[]'}]}, {'name': 'Return', 'children': [{'name': 'Call', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=cls)'}, {'name': 'Load'}]}, {'name': 'Name', 'children': [{'name': 'str(str=app_name)'}, {'name': 'Load'}]}, {'name': 'Name', 'children': [{'name': 'str(str=app_module)'}, {'name': 'Load'}]}, {'name': 'list[]'}]}]}, {'name': 'Name', 'children': [{'name': 'str(str=classmethod)'}, {'name': 'Load'}]}, {'name': 'NoneType'}]}, {'name': 'FunctionDef', 'children': [{'name': 'str(str=get_model)'}, {'name': 'arguments', 'children': [{'name': 'arg', 'children': [{'name': 'str(str=self)'}, {'name': 'NoneType'}]}, {'name': 'arg', 'children': [{'name': 'str(str=model_name)'}, {'name': 'NoneType'}]}, {'name': 'arg', 'children': [{'name': 'str(str=require_ready)'}, {'name': 'NoneType'}]}, {'name': 'NoneType'}, {'name': 'list[]'}, {'name': 'list[]'}, {'name': 'NoneType'}, {'name': 'NameConstant', 'children': [{'name': 'bool(int=True)'}]}]}, {'name': 'Expr', 'children': [{'name': 'Str', 'children': [{'name': 'str'}]}]}, {'name': 'If', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=require_ready)'}, {'name': 'Load'}]}, {'name': 'Expr', 'children': [{'name': 'Call', 'children': [{'name': 'Attribute', 'children': [{'name': 'Attribute', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=self)'}, {'name': 'Load'}]}, {'name': 'str(str=apps)'}, {'name': 'Load'}]}, {'name': 'str(str=check_models_ready)'}, {'name': 'Load'}]}, {'name': 'list[]'}, {'name': 'list[]'}]}]}, {'name': 'Expr', 'children': [{'name': 'Call', 'children': [{'name': 'Attribute', 'children': [{'name': 'Attribute', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=self)'}, {'name': 'Load'}]}, {'name': 'str(str=apps)'}, {'name': 'Load'}]}, {'name': 'str(str=check_apps_ready)'}, {'name': 'Load'}]}, {'name': 'list[]'}, {'name': 'list[]'}]}]}]}, {'name': 'Try', 'children': [{'name': 'Return', 'children': [{'name': 'Subscript', 'children': [{'name': 'Attribute', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=self)'}, {'name': 'Load'}]}, {'name': 'str(str=models)'}, {'name': 'Load'}]}, {'name': 'Index', 'children': [{'name': 'Call', 'children': [{'name': 'Attribute', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=model_name)'}, {'name': 'Load'}]}, {'name': 'str(str=lower)'}, {'name': 'Load'}]}, {'name': 'list[]'}, {'name': 'list[]'}]}]}, {'name': 'Load'}]}]}, {'name': 'ExceptHandler', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=KeyError)'}, {'name': 'Load'}]}, {'name': 'NoneType'}, {'name': 'Raise', 'children': [{'name': 'Call', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=LookupError)'}, {'name': 'Load'}]}, {'name': 'BinOp', 'children': [{'name': 'Str', 'children': [{'name': 'str'}]}, {'name': 'Mod'}, {'name': 'Tuple', 'children': [{'name': 'Attribute', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=self)'}, {'name': 'Load'}]}, {'name': 'str(str=label)'}, {'name': 'Load'}]}, {'name': 'Name', 'children': [{'name': 'str(str=model_name)'}, {'name': 'Load'}]}, {'name': 'Load'}]}]}, {'name': 'list[]'}]}, {'name': 'NoneType'}]}]}, {'name': 'list[]'}, {'name': 'list[]'}]}, {'name': 'list[]'}, {'name': 'NoneType'}]}, {'name': 'FunctionDef', 'children': [{'name': 'str(str=get_models)'}, {'name': 'arguments', 'children': [{'name': 'arg', 'children': [{'name': 'str(str=self)'}, {'name': 'NoneType'}]}, {'name': 'arg', 'children': [{'name': 'str(str=include_auto_created)'}, {'name': 'NoneType'}]}, {'name': 'arg', 'children': [{'name': 'str(str=include_swapped)'}, {'name': 'NoneType'}]}, {'name': 'NoneType'}, {'name': 'list[]'}, {'name': 'list[]'}, {'name': 'NoneType'}, {'name': 'NameConstant', 'children': [{'name': 'bool(int=False)'}]}, {'name': 'NameConstant', 'children': [{'name': 'bool(int=False)'}]}]}, {'name': 'Expr', 'children': [{'name': 'Str', 'children': [{'name': 'str'}]}]}, {'name': 'Expr', 'children': [{'name': 'Call', 'children': [{'name': 'Attribute', 'children': [{'name': 'Attribute', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=self)'}, {'name': 'Load'}]}, {'name': 'str(str=apps)'}, {'name': 'Load'}]}, {'name': 'str(str=check_models_ready)'}, {'name': 'Load'}]}, {'name': 'list[]'}, {'name': 'list[]'}]}]}, {'name': 'For', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=model)'}, {'name': 'Store'}]}, {'name': 'Call', 'children': [{'name': 'Attribute', 'children': [{'name': 'Attribute', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=self)'}, {'name': 'Load'}]}, {'name': 'str(str=models)'}, {'name': 'Load'}]}, {'name': 'str(str=values)'}, {'name': 'Load'}]}, {'name': 'list[]'}, {'name': 'list[]'}]}, {'name': 'If', 'children': [{'name': 'BoolOp', 'children': [{'name': 'And'}, {'name': 'Attribute', 'children': [{'name': 'Attribute', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=model)'}, {'name': 'Load'}]}, {'name': 'str(str=_meta)'}, {'name': 'Load'}]}, {'name': 'str(str=auto_created)'}, {'name': 'Load'}]}, {'name': 'UnaryOp', 'children': [{'name': 'Not'}, {'name': 'Name', 'children': [{'name': 'str(str=include_auto_created)'}, {'name': 'Load'}]}]}]}, {'name': 'Continue'}, {'name': 'list[]'}]}, {'name': 'If', 'children': [{'name': 'BoolOp', 'children': [{'name': 'And'}, {'name': 'Attribute', 'children': [{'name': 'Attribute', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=model)'}, {'name': 'Load'}]}, {'name': 'str(str=_meta)'}, {'name': 'Load'}]}, {'name': 'str(str=swapped)'}, {'name': 'Load'}]}, {'name': 'UnaryOp', 'children': [{'name': 'Not'}, {'name': 'Name', 'children': [{'name': 'str(str=include_swapped)'}, {'name': 'Load'}]}]}]}, {'name': 'Continue'}, {'name': 'list[]'}]}, {'name': 'Expr', 'children': [{'name': 'Yield', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=model)'}, {'name': 'Load'}]}]}]}, {'name': 'list[]'}]}, {'name': 'list[]'}, {'name': 'NoneType'}]}, {'name': 'FunctionDef', 'children': [{'name': 'str(str=import_models)'}, {'name': 'arguments', 'children': [{'name': 'arg', 'children': [{'name': 'str(str=self)'}, {'name': 'NoneType'}]}, {'name': 'NoneType'}, {'name': 'list[]'}, {'name': 'list[]'}, {'name': 'NoneType'}, {'name': 'list[]'}]}, {'name': 'Assign', 'children': [{'name': 'Attribute', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=self)'}, {'name': 'Load'}]}, {'name': 'str(str=models)'}, {'name': 'Store'}]}, {'name': 'Subscript', 'children': [{'name': 'Attribute', 'children': [{'name': 'Attribute', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=self)'}, {'name': 'Load'}]}, {'name': 'str(str=apps)'}, {'name': 'Load'}]}, {'name': 'str(str=all_models)'}, {'name': 'Load'}]}, {'name': 'Index', 'children': [{'name': 'Attribute', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=self)'}, {'name': 'Load'}]}, {'name': 'str(str=label)'}, {'name': 'Load'}]}]}, {'name': 'Load'}]}]}, {'name': 'If', 'children': [{'name': 'Call', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=module_has_submodule)'}, {'name': 'Load'}]}, {'name': 'Attribute', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=self)'}, {'name': 'Load'}]}, {'name': 'str(str=module)'}, {'name': 'Load'}]}, {'name': 'Name', 'children': [{'name': 'str(str=MODELS_MODULE_NAME)'}, {'name': 'Load'}]}, {'name': 'list[]'}]}, {'name': 'Assign', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=models_module_name)'}, {'name': 'Store'}]}, {'name': 'BinOp', 'children': [{'name': 'Str', 'children': [{'name': 'str'}]}, {'name': 'Mod'}, {'name': 'Tuple', 'children': [{'name': 'Attribute', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=self)'}, {'name': 'Load'}]}, {'name': 'str(str=name)'}, {'name': 'Load'}]}, {'name': 'Name', 'children': [{'name': 'str(str=MODELS_MODULE_NAME)'}, {'name': 'Load'}]}, {'name': 'Load'}]}]}]}, {'name': 'Assign', 'children': [{'name': 'Attribute', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=self)'}, {'name': 'Load'}]}, {'name': 'str(str=models_module)'}, {'name': 'Store'}]}, {'name': 'Call', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=import_module)'}, {'name': 'Load'}]}, {'name': 'Name', 'children': [{'name': 'str(str=models_module_name)'}, {'name': 'Load'}]}, {'name': 'list[]'}]}]}, {'name': 'list[]'}]}, {'name': 'list[]'}, {'name': 'NoneType'}]}, {'name': 'FunctionDef', 'children': [{'name': 'str(str=ready)'}, {'name': 'arguments', 'children': [{'name': 'arg', 'children': [{'name': 'str(str=self)'}, {'name': 'NoneType'}]}, {'name': 'NoneType'}, {'name': 'list[]'}, {'name': 'list[]'}, {'name': 'NoneType'}, {'name': 'list[]'}]}, {'name': 'Expr', 'children': [{'name': 'Str', 'children': [{'name': 'str'}]}]}, {'name': 'list[]'}, {'name': 'NoneType'}]}, {'name': 'list[]'}]}]}
    assert add_node_id(a,1)
    b={'name': 'Module', 'children': [{'name': 'Import', 'children': [{'name': 'sss'}]}]}
    add_node_id(b, 1)
    assert b=={'name': 'Module', 'id':1,'children': [{'name': 'Import', 'id':2,'children': [{'name': 'sss','id':3}]}]}

def test_get_node():
    b = {'name': 'Module', 'id':1,'children': [{'name': 'Import', 'id':2,'children': [{'name': 'sss','id':3}]}]}
    assert get_node(b,3)=={'name': 'sss', 'id': 3}

def test_get_name_value():
    # case1
    a={'name': 'Name', 'children': [{'name': 'str(str=data)', 'id': 374}, {'name': 'Store', 'id': 375}], 'id': 373}
    assert get_name_value(a)=='str(str=data)'
    # case2
    a={'name': 'str(str=argv)', 'id': 35}
    assert get_name_value(a)=='str(str=argv)'
    # case3
    a={'name': 'Attribute', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=self)', 'id': 385}, {'name': 'Load', 'id': 386}], 'id': 384}, {'name': 'str(str=_current)', 'id': 387}, {'name': 'Load', 'id': 388}], 'id': 383}
    assert get_name_value(a)=='self._current'
    # case4
    a={'name': 'keyword', 'children': [{'name': 'str(str=dir)', 'id': 36}, {'name': 'Attribute', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=self)', 'id': 39}, {'name': 'Load', 'id': 40}], 'id': 38}, {'name': 'str(str=_dir)', 'id': 41}, {'name': 'Load', 'id': 42}], 'id': 37}], 'id': 35}
    assert get_name_value(a)=='str(str=dir)######self._dir'

def test_get_arg_value():
    # see ./get_arg_value/demo.py
    a={'name': 'arg', 'children': [{'name': 'str(str=a)', 'id': 6}, {'name': 'NoneType', 'id': 7}], 'id': 5}
    assert get_arg_value(a)=='str(str=a)'

def test_get_all_assigns():
    # demo code in test/get_all_assigns/demo.py
    begin_id=2
    end_id=45
    node_dict={'name': 'Module', 'children': [{'name': 'FunctionDef', 'children': [{'name': 'str(str=set)', 'id': 3}, {'name': 'arguments', 'children': [{'name': 'arg', 'children': [{'name': 'str(str=a)', 'id': 6}, {'name': 'NoneType', 'id': 7}], 'id': 5}, {'name': 'arg', 'children': [{'name': 'str(str=b)', 'id': 9}, {'name': 'NoneType', 'id': 10}], 'id': 8}, {'name': 'NoneType', 'id': 11}, {'name': 'list[]', 'id': 12}, {'name': 'list[]', 'id': 13}, {'name': 'NoneType', 'id': 14}, {'name': 'list[]', 'id': 15}], 'id': 4}, {'name': 'Assign', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=c)', 'id': 18}, {'name': 'Store', 'id': 19}], 'id': 17}, {'name': 'BinOp', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=a)', 'id': 22}, {'name': 'Load', 'id': 23}], 'id': 21}, {'name': 'Add', 'id': 24}, {'name': 'Name', 'children': [{'name': 'str(str=b)', 'id': 26}, {'name': 'Load', 'id': 27}], 'id': 25}], 'id': 20}], 'id': 16}, {'name': 'Expr', 'children': [{'name': 'Call', 'children': [{'name': 'Attribute', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=pickle)', 'id': 32}, {'name': 'Load', 'id': 33}], 'id': 31}, {'name': 'str(str=loads)', 'id': 34}, {'name': 'Load', 'id': 35}], 'id': 30}, {'name': 'Name', 'children': [{'name': 'str(str=c)', 'id': 37}, {'name': 'Load', 'id': 38}], 'id': 36}, {'name': 'list[]', 'id': 39}], 'id': 29}], 'id': 28}, {'name': 'Return', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=c)', 'id': 42}, {'name': 'Load', 'id': 43}], 'id': 41}], 'id': 40}, {'name': 'list[]', 'id': 44}, {'name': 'NoneType', 'id': 45}], 'id': 2}], 'id': 1}
    assert get_all_assigns(node_dict,(begin_id,end_id))=='left:str(str=a),right:fp$$$$$$left:str(str=b),right:fp$$$$$$left:str(str=c),right:str(str=a)######str(str=b)'

def test_get_all_functiondef():
    #demo code in test/get_all_functiondef
    node_dict={'name': 'Module', 'children': [{'name': 'Expr', 'children': [{'name': 'Str', 'children': [{'name': 'str', 'id': 4}], 'id': 3}], 'id': 2}, {'name': 'FunctionDef', 'children': [{'name': 'str(str=Add)', 'id': 6}, {'name': 'arguments', 'children': [{'name': 'arg', 'children': [{'name': 'str(str=a)', 'id': 9}, {'name': 'NoneType', 'id': 10}], 'id': 8}, {'name': 'arg', 'children': [{'name': 'str(str=b)', 'id': 12}, {'name': 'NoneType', 'id': 13}], 'id': 11}, {'name': 'NoneType', 'id': 14}, {'name': 'list[]', 'id': 15}, {'name': 'list[]', 'id': 16}, {'name': 'NoneType', 'id': 17}, {'name': 'list[]', 'id': 18}], 'id': 7}, {'name': 'Assign', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=c)', 'id': 21}, {'name': 'Store', 'id': 22}], 'id': 20}, {'name': 'BinOp', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=a)', 'id': 25}, {'name': 'Load', 'id': 26}], 'id': 24}, {'name': 'Add', 'id': 27}, {'name': 'Name', 'children': [{'name': 'str(str=b)', 'id': 29}, {'name': 'Load', 'id': 30}], 'id': 28}], 'id': 23}], 'id': 19}, {'name': 'Return', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=c)', 'id': 33}, {'name': 'Load', 'id': 34}], 'id': 32}], 'id': 31}, {'name': 'list[]', 'id': 35}, {'name': 'NoneType', 'id': 36}], 'id': 5}, {'name': 'ClassDef', 'children': [{'name': 'str(str=A)', 'id': 38}, {'name': 'list[]', 'id': 39}, {'name': 'list[]', 'id': 40}, {'name': 'FunctionDef', 'children': [{'name': 'str(str=__init__)', 'id': 42}, {'name': 'arguments', 'children': [{'name': 'arg', 'children': [{'name': 'str(str=self)', 'id': 45}, {'name': 'NoneType', 'id': 46}], 'id': 44}, {'name': 'arg', 'children': [{'name': 'str(str=name)', 'id': 48}, {'name': 'NoneType', 'id': 49}], 'id': 47}, {'name': 'NoneType', 'id': 50}, {'name': 'list[]', 'id': 51}, {'name': 'list[]', 'id': 52}, {'name': 'NoneType', 'id': 53}, {'name': 'list[]', 'id': 54}], 'id': 43}, {'name': 'Assign', 'children': [{'name': 'Attribute', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=self)', 'id': 58}, {'name': 'Load', 'id': 59}], 'id': 57}, {'name': 'str(str=name)', 'id': 60}, {'name': 'Store', 'id': 61}], 'id': 56}, {'name': 'Name', 'children': [{'name': 'str(str=name)', 'id': 63}, {'name': 'Load', 'id': 64}], 'id': 62}], 'id': 55}, {'name': 'list[]', 'id': 65}, {'name': 'NoneType', 'id': 66}], 'id': 41}, {'name': 'FunctionDef', 'children': [{'name': 'str(str=func1)', 'id': 68}, {'name': 'arguments', 'children': [{'name': 'arg', 'children': [{'name': 'str(str=self)', 'id': 71}, {'name': 'NoneType', 'id': 72}], 'id': 70}, {'name': 'NoneType', 'id': 73}, {'name': 'list[]', 'id': 74}, {'name': 'list[]', 'id': 75}, {'name': 'NoneType', 'id': 76}, {'name': 'list[]', 'id': 77}], 'id': 69}, {'name': 'Expr', 'children': [{'name': 'Call', 'children': [{'name': 'Attribute', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=pickle)', 'id': 82}, {'name': 'Load', 'id': 83}], 'id': 81}, {'name': 'str(str=loads)', 'id': 84}, {'name': 'Load', 'id': 85}], 'id': 80}, {'name': 'Attribute', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=self)', 'id': 88}, {'name': 'Load', 'id': 89}], 'id': 87}, {'name': 'str(str=name)', 'id': 90}, {'name': 'Load', 'id': 91}], 'id': 86}, {'name': 'list[]', 'id': 92}], 'id': 79}], 'id': 78}, {'name': 'Return', 'children': [{'name': 'Attribute', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=self)', 'id': 96}, {'name': 'Load', 'id': 97}], 'id': 95}, {'name': 'str(str=name)', 'id': 98}, {'name': 'Load', 'id': 99}], 'id': 94}], 'id': 93}, {'name': 'list[]', 'id': 100}, {'name': 'NoneType', 'id': 101}], 'id': 67}, {'name': 'list[]', 'id': 102}], 'id': 37}], 'id': 1}
    assert get_all_functiondef(node_dict)=='begin:5,end:36$$$$$$begin:41,end:66$$$$$$begin:67,end:101'

def test_get_all_classdef():
    #demo code in test/get_all_classdef
    node_dict={'name': 'Module', 'children': [{'name': 'Expr', 'children': [{'name': 'Str', 'children': [{'name': 'str', 'id': 4}], 'id': 3}], 'id': 2}, {'name': 'ClassDef', 'children': [{'name': 'str(str=A)', 'id': 6}, {'name': 'list[]', 'id': 7}, {'name': 'list[]', 'id': 8}, {'name': 'FunctionDef', 'children': [{'name': 'str(str=__init__)', 'id': 10}, {'name': 'arguments', 'children': [{'name': 'arg', 'children': [{'name': 'str(str=self)', 'id': 13}, {'name': 'NoneType', 'id': 14}], 'id': 12}, {'name': 'arg', 'children': [{'name': 'str(str=name)', 'id': 16}, {'name': 'NoneType', 'id': 17}], 'id': 15}, {'name': 'NoneType', 'id': 18}, {'name': 'list[]', 'id': 19}, {'name': 'list[]', 'id': 20}, {'name': 'NoneType', 'id': 21}, {'name': 'list[]', 'id': 22}], 'id': 11}, {'name': 'Assign', 'children': [{'name': 'Attribute', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=self)', 'id': 26}, {'name': 'Load', 'id': 27}], 'id': 25}, {'name': 'str(str=name)', 'id': 28}, {'name': 'Store', 'id': 29}], 'id': 24}, {'name': 'Name', 'children': [{'name': 'str(str=name)', 'id': 31}, {'name': 'Load', 'id': 32}], 'id': 30}], 'id': 23}, {'name': 'list[]', 'id': 33}, {'name': 'NoneType', 'id': 34}], 'id': 9}, {'name': 'FunctionDef', 'children': [{'name': 'str(str=func1)', 'id': 36}, {'name': 'arguments', 'children': [{'name': 'arg', 'children': [{'name': 'str(str=self)', 'id': 39}, {'name': 'NoneType', 'id': 40}], 'id': 38}, {'name': 'NoneType', 'id': 41}, {'name': 'list[]', 'id': 42}, {'name': 'list[]', 'id': 43}, {'name': 'NoneType', 'id': 44}, {'name': 'list[]', 'id': 45}], 'id': 37}, {'name': 'Expr', 'children': [{'name': 'Call', 'children': [{'name': 'Attribute', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=pickle)', 'id': 50}, {'name': 'Load', 'id': 51}], 'id': 49}, {'name': 'str(str=loads)', 'id': 52}, {'name': 'Load', 'id': 53}], 'id': 48}, {'name': 'Attribute', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=self)', 'id': 56}, {'name': 'Load', 'id': 57}], 'id': 55}, {'name': 'str(str=name)', 'id': 58}, {'name': 'Load', 'id': 59}], 'id': 54}, {'name': 'list[]', 'id': 60}], 'id': 47}], 'id': 46}, {'name': 'Return', 'children': [{'name': 'Attribute', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=self)', 'id': 64}, {'name': 'Load', 'id': 65}], 'id': 63}, {'name': 'str(str=name)', 'id': 66}, {'name': 'Load', 'id': 67}], 'id': 62}], 'id': 61}, {'name': 'list[]', 'id': 68}, {'name': 'NoneType', 'id': 69}], 'id': 35}, {'name': 'list[]', 'id': 70}], 'id': 5}], 'id': 1}
    assert get_all_classdef(node_dict)=='begin:5,end:70'

def test_get_end_id():
    # demo code in test/get_end_id
    root={'name': 'FunctionDef', 'children': [{'name': 'str(str=func1)', 'id': 6}, {'name': 'arguments', 'children': [{'name': 'arg', 'children': [{'name': 'str(str=self)', 'id': 9}, {'name': 'NoneType', 'id': 10}], 'id': 8}, {'name': 'NoneType', 'id': 11}, {'name': 'list[]', 'id': 12}, {'name': 'list[]', 'id': 13}, {'name': 'NoneType', 'id': 14}, {'name': 'list[]', 'id': 15}], 'id': 7}, {'name': 'Expr', 'children': [{'name': 'Call', 'children': [{'name': 'Attribute', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=pickle)', 'id': 20}, {'name': 'Load', 'id': 21}], 'id': 19}, {'name': 'str(str=loads)', 'id': 22}, {'name': 'Load', 'id': 23}], 'id': 18}, {'name': 'Attribute', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=self)', 'id': 26}, {'name': 'Load', 'id': 27}], 'id': 25}, {'name': 'str(str=name)', 'id': 28}, {'name': 'Load', 'id': 29}], 'id': 24}, {'name': 'list[]', 'id': 30}], 'id': 17}], 'id': 16}, {'name': 'Return', 'children': [{'name': 'Attribute', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=self)', 'id': 34}, {'name': 'Load', 'id': 35}], 'id': 33}, {'name': 'str(str=name)', 'id': 36}, {'name': 'Load', 'id': 37}], 'id': 32}], 'id': 31}, {'name': 'list[]', 'id': 38}, {'name': 'NoneType', 'id': 39}], 'id': 5}
    assert get_end_id(root)==35

def test_get_call_details():
    #demo code in test/get_call_details
    call_node={'name': 'Call', 'children': [{'name': 'Attribute', 'children': [{'name': 'Name', 'children': [{'name': 'str(str=pickle)', 'id': 24}, {'name': 'Load', 'id': 25}], 'id': 23}, {'name': 'str(str=loads)', 'id': 26}, {'name': 'Load', 'id': 27}], 'id': 22}, {'name': 'Name', 'children': [{'name': 'str(str=name)', 'id': 29}, {'name': 'Load', 'id': 30}], 'id': 28}, {'name': 'list[]', 'id': 31}], 'id': 21}
    assert get_call_details(call_node)=='pickle.loads$$$$$$pickle$$$$$$str(str=name)'

def test_is_tracked():
    #demo code in test/is_tracked/demo.py
    # case1
    assign_list=[('name', ['fp'])]
    # case2
    assign_list2=[('name', ['fp']), ('a', ['aaa']), ('b', ['bbb']), ('c', ['a', 'b'])]
    # case3
    assign_list3=[('name', ['fp']), ('a', ['aaa']), ('b', ['bbb']), ('c', ['a', 'b', 'name'])]
    assert is_tracked(assign_list,'name')==True
    assert is_tracked(assign_list2, 'c')!=True
    assert is_tracked(assign_list3,'c')==True

def test_is_controllable():
    # demo code in test/is_controllable
    # case1
    assign_list=[('name', ['fp']), ('a', ['aaa']), ('b', ['bbb', 'sys.argv']), ('c', ['a', 'b', 'name'])]
    assert is_controllable(assign_list,'c')==[(['bbb', 'sys.argv'], 'sys.argv')]

def test_ins_is_class():
    # demo code in test/ins_is_class
    ins='ins'
    all_assigns=[('self', ['fp']), ('a', ['fp']), ('b', ['a']), ('ins', ['A', 'b'])]
    assert ins_is_class(ins,'A',all_assigns)==True

def test_get_class_name():
    assert get_class_name('ClassCall:A.func1')=='A'


if __name__=='__main__':
    pytest.main(['unit_test.py'])